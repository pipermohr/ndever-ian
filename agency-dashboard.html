<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ndever Agency Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDNs (for in-browser JSX transpilation via Babel) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transpilation. Not for production! -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom styles for the form checkbox */
      .form-checkbox {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        border: 1px solid #d1d5db; /* gray-300 */
        border-radius: 0.25rem; /* rounded */
        width: 1.25rem; /* h-5 */
        height: 1.25rem; /* w-5 */
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        vertical-align: middle;
        position: relative;
      }

      .form-checkbox:checked {
        background-color: #4f46e5; /* indigo-600 */
        border-color: #4f46e5; /* indigo-600 */
      }

      .form-checkbox:checked::before {
        content: '\2713'; /* Checkmark unicode character */
        color: white;
        font-size: 0.875rem; /* text-sm */
        line-height: 1;
      }

      .form-checkbox:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); /* indigo-500 with opacity */
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Start of the React App component code from the Canvas
        function App() {
          const [objectives, setObjectives] = React.useState([]);
          const [automations, setAutomations] = React.useState([]);
          // Initialize kpis with default structure to prevent "undefined" errors
          const [kpis, setKpis] = React.useState({
            ytd_revenue: { value: 0, source: '' },
            active_clients: { value: 0, source: '' },
            leads_this_month: { value: 0, source: '' },
            conversion_rate_month: { value: 0, source: '' },
          });
          const [coachMessages, setCoachMessages] = React.useState([]);
          const [upcomingTasks, setUpcomingTasks] = React.useState([]);

          React.useEffect(() => {
            // Simulate fetching initial dashboard data
            const fetchDashboardData = () => {
              setObjectives([
                {
                  id: 'obj1',
                  name: 'Annual GCI Target 2025',
                  status: 'on_track', // on_track, at_risk, behind, completed
                  progress: 65,
                  metrics_definition: {
                    gci_target: { type: 'currency', label: 'GCI Target' },
                    current_gci: { type: 'currency', label: 'Current GCI' },
                    leads_generated: { type: 'number', label: 'Leads Generated' },
                    conversion_rate: { type: 'percentage', label: 'Conversion Rate' },
                  },
                  current_values: {
                    gci_target: 250000,
                    current_gci: 162500,
                    leads_generated: 150,
                    conversion_rate: 0.08, // 8%
                  },
                  target_values: {
                    gci_target: 250000,
                    leads_generated: 200,
                    conversion_rate: 0.10, // 10%
                  },
                },
                {
                  id: 'obj2',
                  name: 'Increase Client Referrals',
                  status: 'at_risk',
                  progress: 40,
                  metrics_definition: {
                    referrals_target: { type: 'number', label: 'Referrals Target' },
                    current_referrals: { type: 'number', label: 'Current Referrals' },
                    client_satisfaction_score: { type: 'scale', label: 'CSAT Score' },
                  },
                  current_values: {
                    referrals_target: 50,
                    current_referrals: 20,
                    client_satisfaction_score: 4.2,
                  },
                  target_values: {
                    referrals_target: 50,
                    client_satisfaction_score: 4.5,
                  },
                },
              ]);

              setKpis({
                ytd_revenue: { value: 175000, source: 'Quickbooks' },
                active_clients: { value: 120, source: 'CRM (e.g., Follow Up Boss)' },
                leads_this_month: { value: 25, source: 'CRM (e.g., Follow Up Boss)' },
                conversion_rate_month: { value: 0.07, source: 'Derived from CRM' },
              });

              setAutomations([
                {
                  id: 'auto1',
                  name: 'Past Client Nurturing Sequence',
                  status: 'Active',
                  executions_today: 15,
                  executions_this_week: 75,
                  type: 'email_sequence',
                  last_executed: '2025-06-09T14:30:00Z',
                  integration_source: 'Mailchimp & CRM'
                },
                {
                  id: 'auto2',
                  name: 'Birthday Flower Send',
                  status: 'Active',
                  executions_today: 2,
                  executions_this_week: 8,
                  type: 'gift_delivery',
                  last_executed: '2025-06-09T10:00:00Z',
                  integration_source: 'Flower Delivery Service & CRM'
                },
                {
                  id: 'auto3',
                  name: 'New Prospect Onboarding',
                  status: 'Active',
                  executions_today: 3,
                  executions_this_week: 12,
                  type: 'crm_update_sms',
                  last_executed: '2025-06-09T09:15:00Z',
                  integration_source: 'CRM & Twilio (SMS)'
                },
                 {
                  id: 'auto4',
                  name: 'Referral Follow-up Check-in',
                  status: 'Active',
                  executions_today: 5,
                  executions_this_week: 20,
                  type: 'email_notification',
                  last_executed: '2025-06-09T11:00:00Z',
                  integration_source: 'CRM & Internal Ndever'
                },
              ]);

              setCoachMessages([
                { sender: 'coach', text: "Good morning, Loren! Your 'Increase Client Referrals' objective is currently at 40%, and your 'Referral Partner Check-ins' automation ran 5 times today. Your 'Client Satisfaction Score' is excellent at 4.2. Shall we activate the advanced 'Past Client Nurturing' workflow to maximize repeat and referral business?" },
                { sender: 'user', text: "Morning! Yes, let's talk about client nurturing. I want to make sure I'm not dropping any referrals and staying top-of-mind without feeling overwhelmed." },
                { sender: 'coach', text: "Understood. The 'Past Client Nurturing' workflow will automate personalized emails and prompt you for birthday/anniversary touches. I've also highlighted tasks in your 'Client Retention Playbook' that focus on direct outreach to your key referral partners. How does that sound?" },
                { sender: 'user' , text: "Thanks. Can you also help me with level-up my prospecting?" },
                { sender: 'coach', text: "Absolutely. I've highlighted tasks in your \"Prospecting Playbook\" that directly impact lead volume. Also, consider activating the \"Automated Lead Nurturing\" workflow for recent website visitors." },
              ]);

              setUpcomingTasks([
                { id: 'task1', name: 'Review Ndever Coach QuickBooks analysis of Q2 budget (Playbook: Financial Health)', dueDate: 'Today' },
                { id: 'task2', name: 'Call client Barbara for referral (Playbook: Client Retention)', dueDate: 'Thu, Jun 12' },
                { id: 'task3', name: 'Send contract to new buyer via CRM template (Playbook: Deal Closure)', dueDate: 'Tomorrow' },
              ]);
            };

            fetchDashboardData();
          }, []);

          const formatCurrency = (value) => {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
          };

          const formatPercentage = (value) => {
            return new Intl.NumberFormat('en-US', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 }).format(value);
          };

          const MetricDisplay = ({ definition, value, target }) => {
            let displayValue = value;
            if (definition.type === 'currency') displayValue = formatCurrency(value);
            if (definition.type === 'percentage') displayValue = formatPercentage(value);

            let targetDisplay = target;
            if (definition.type === 'currency') targetDisplay = formatCurrency(target);
            if (definition.type === 'percentage') targetDisplay = formatPercentage(target);

            return (
              <div className="flex justify-between text-sm text-gray-700">
                <span>{definition.label}: <span className="font-semibold">{displayValue}</span></span>
                {target !== undefined && <span className="text-gray-500">Target: {targetDisplay}</span>}
              </div>
            );
          };

          const ObjectiveCard = ({ objective }) => {
            const statusColor = {
              'on_track': 'bg-green-100 text-green-800',
              'at_risk': 'bg-yellow-100 text-yellow-800',
              'behind': 'bg-red-100 text-red-800',
              'completed': 'bg-blue-100 text-blue-800',
            };

            return (
              <div className="bg-white p-4 rounded-lg shadow-sm mb-4">
                <div className="flex justify-between items-center mb-2">
                  <h3 className="text-lg font-semibold text-gray-800">{objective.name}</h3>
                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColor[objective.status]}`}>
                    {objective.status.replace('_', ' ').charAt(0).toUpperCase() + objective.status.replace('_', ' ').slice(1)}
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                  <div className="bg-blue-500 h-2.5 rounded-full" style={{ width: `${objective.progress}%` }}></div>
                </div>
                <p className="text-sm text-gray-600 mb-3">{objective.progress}% Progress</p>
                <div className="space-y-1">
                  {Object.keys(objective.metrics_definition).map((key) => (
                    <MetricDisplay
                      key={key}
                      definition={objective.metrics_definition[key]}
                      value={objective.current_values[key]}
                      target={objective.target_values[key]}
                    />
                  ))}
                </div>
              </div>
            );
          };

          const AutomationCard = ({ automation }) => {
            return (
              <div className="flex items-center justify-between bg-white p-3 rounded-lg shadow-sm text-gray-700 mb-2">
                <div>
                  <h4 className="font-medium text-gray-800">{automation.name}</h4>
                  <p className="text-xs text-gray-500">Last run: {new Date(automation.last_executed).toLocaleTimeString()}</p>
                  {automation.integration_source && (
                    <p className="text-xs text-gray-500 mt-1">
                      <span className="font-medium text-gray-600">Source:</span> {automation.integration_source}
                    </p>
                  )}
                </div>
                <div className="text-right">
                  <p className="text-sm font-semibold">{automation.executions_today} Today</p>
                  <p className="text-xs text-gray-600">{automation.executions_this_week} This Week</p>
                </div>
              </div>
            );
          };

          const KPICard = ({ title, value, source }) => {
            return (
              <div className="bg-white p-5 rounded-lg shadow-sm flex flex-col items-start">
                <span className="text-sm text-gray-500">{title}</span>
                <span className="text-2xl font-bold text-indigo-700">{value}</span>
                {source && <span className="text-xs text-gray-500 mt-1">Source: {source}</span>}
              </div>
            );
          };


          return (
            <div className="min-h-screen bg-gray-50 font-sans text-gray-900">
              {/* Header */}
              <header className="bg-white shadow-sm p-4 flex justify-between items-center border-b border-gray-200">
                <div className="flex items-center">
                  {/* Ndever Logo Placeholder */}
                  <span className="text-2xl font-bold text-indigo-700 mr-4">Ndever</span>
                  <h1 className="text-xl font-semibold text-gray-800">Agency Dashboard</h1>
                </div>
                <div className="flex items-center space-x-4">
                  <span className="text-gray-600">Hi, Loren!</span>
                  {/* User Avatar Placeholder */}
                  <div className="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center text-blue-800 font-bold">L</div>
                </div>
              </header>

              <main className="p-6 md:p-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Left Column: Objectives, KPIs, Upcoming Tasks */}
                <div className="lg:col-span-2 space-y-6">
                  {/* Overview KPIs */}
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <KPICard title="YTD Revenue" value={formatCurrency(kpis.ytd_revenue.value)} source={kpis.ytd_revenue.source} />
                    <KPICard title="Active Clients" value={kpis.active_clients.value} source={kpis.active_clients.source} />
                    <KPICard title="Leads This Month" value={kpis.leads_this_month.value} source={kpis.leads_this_month.source} />
                    <KPICard title="Conversion Rate (Mo)" value={formatPercentage(kpis.conversion_rate_month.value)} source={kpis.conversion_rate_month.source} />
                  </div>

                  {/* Objectives Section */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Your Active Objectives</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {objectives.map(obj => (
                        <ObjectiveCard key={obj.id} objective={obj} />
                      ))}
                    </div>
                  </section>

                  {/* Upcoming Tasks */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Upcoming Tasks</h2>
                    <ul className="space-y-3">
                      {upcomingTasks.map(task => (
                        <li key={task.id} className="flex items-center bg-gray-50 p-3 rounded-lg shadow-sm">
                          <input type="checkbox" className="form-checkbox h-5 w-5 text-indigo-600 rounded mr-3" />
                          <div className="flex-1">
                            <p className="text-base font-medium text-gray-800">{task.name}</p>
                            <p className="text-sm text-gray-500">{task.dueDate}</p>
                          </div>
                        </li>
                      ))}
                    </ul>
                  </section>
                </div>

                {/* Right Column: Ndever Coach, Automation Summary */}
                <div className="space-y-6">
                  {/* Ndever Coach Chat */}
                  <section className="bg-white p-6 rounded-lg shadow-md h-96 flex flex-col">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Ndever Coach</h2>
                    <div className="flex-1 overflow-y-auto border border-gray-200 p-3 rounded-lg bg-gray-50 mb-3 text-sm">
                      {coachMessages.map((msg, index) => (
                        <div key={index} className={`mb-2 ${msg.sender === 'user' ? 'text-right' : 'text-left'}`}>
                          <span className={`inline-block p-2 rounded-lg ${
                            msg.sender === 'user' ? 'bg-indigo-500 text-white' : 'bg-gray-200 text-gray-800'
                          }`}>
                            {msg.text}
                          </span>
                        </div>
                      ))}
                      <div className="text-gray-400 text-xs text-center mt-2">Ndever Coach is typing...</div>
                    </div>
                    <div className="flex">
                      <input
                        type="text"
                        placeholder="Message Ndever Coach..."
                        className="flex-1 border border-gray-300 p-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      />
                      <button className="bg-indigo-600 text-white p-2 rounded-r-lg hover:bg-indigo-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                          <path strokeLinecap="round" strokeLinejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                      </button>
                    </div>
                  </section>

                  {/* Workflow Automation Summary */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                      Workflow Automations
                      <span className="ml-2 px-2 py-1 bg-indigo-100 text-indigo-700 text-sm font-medium rounded-full">Active: {automations.length}</span>
                    </h2>
                    <div className="space-y-3">
                      <div className="bg-gray-100 p-4 rounded-lg text-center text-gray-700 font-semibold text-lg">
                        <span className="text-3xl font-bold text-indigo-700 mr-2">20</span>Automations Executed Today
                      </div>
                      {automations.map(auto => (
                        <AutomationCard key={auto.id} automation={auto} />
                      ))}
                    </div>
                  </section>
                </div>
              </main>
            </div>
          );
        }

        // Mount the React App to the DOM
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container); // Create a root
        root.render(<App />); // Render the App
    </script>
</body>
</html>
