<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ndever Agency Dashboard</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="./favicon.png">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDNs (for in-browser JSX transpilation via Babel) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transpilation. Not for production! -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom styles for the form checkbox */
      .form-checkbox {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        border: 1px solid var(--color-gray-300); /* gray-300 */
        border-radius: 0.25rem; /* rounded */
        width: 1.25rem; /* h-5 */
        height: 1.25rem; /* w-5 */
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        vertical-align: middle;
        position: relative;
      }

      .form-checkbox:checked {
        background-color: var(--color-primary-600); /* Using new theme variable */
        border-color: var(--color-primary-600); /* Using new theme variable */
      }

      .form-checkbox:checked::before {
        content: '\2713'; /* Checkmark unicode character */
        color: white;
        font-size: 0.875rem; /* text-sm */
        line-height: 1;
      }

      .form-checkbox:focus {
        outline: none;
        box-shadow: 0 0 0 3px var(--color-primary-500); /* Using new theme variable */
      }

      /* Theme CSS Variables */
      :root {
        --color-casablanca-50: #fef8ee;
        --color-casablanca-100: #fdf0d7;
        --color-casablanca-200: #faddae;
        --color-casablanca-300: #f4b860;
        --color-casablanca-400: #f1a146;
        --color-casablanca-500: #ed8622;
        --color-casablanca-600: #de6d18;
        --color-casablanca-700: #b95315;
        --color-casablanca-800: #934219;
        --color-casablanca-900: #763818;
        --color-casablanca-950: #401b0a;

        --color-primary-50: var(--color-casablanca-50);
        --color-primary-100: var(--color-casablanca-100);
        --color-primary-200: var(--color-casablanca-200);
        --color-primary-300: var(--color-casablanca-300);
        --color-primary-400: var(--color-casablanca-400);
        --color-primary-500: var(--color-casablanca-500);
        --color-primary-600: var(--color-casablanca-600);
        --color-primary-700: var(--color-casablanca-700);
        --color-primary-800: var(--color-casablanca-800);
        --color-primary-900: var(--color-casablanca-900);
        --color-primary-950: var(--color-casablanca-950);

        /* Assuming standard Tailwind colors for these missing base definitions */
        --color-teal-50: #f0fdfa;
        --color-teal-100: #ccfbf1;
        --color-teal-200: #99f6e4;
        --color-teal-300: #5eead4;
        --color-teal-400: #2dd4bf;
        --color-teal-500: #14b8a6;
        --color-teal-600: #0d9488;
        --color-teal-700: #0f766e;
        --color-teal-800: #115e59;
        --color-teal-900: #134e4a;
        --color-teal-950: #042f2e;

        --color-secondary-50: var(--color-teal-50);
        --color-secondary-100: var(--color-teal-100);
        --color-secondary-200: var(--color-teal-200);
        --color-secondary-300: var(--color-teal-300);
        --color-secondary-400: var(--color-teal-400);
        --color-secondary-500: var(--color-teal-500);
        --color-secondary-600: var(--color-teal-600);
        --color-secondary-700: var(--color-teal-700);
        --color-secondary-800: var(--color-teal-800);
        --color-secondary-900: var(--color-teal-900);
        --color-secondary-950: var(--color-teal-950);

        --color-green-50: #f0fdf4;
        --color-green-100: #dcfce7;
        --color-green-200: #bbf7d0;
        --color-green-300: #86efac;
        --color-green-400: #4ade80;
        --color-green-500: #22c55e;
        --color-green-600: #16a34a;
        --color-green-700: #15803d;
        --color-green-800: #166534;
        --color-green-900: #14532d;
        --color-green-950: #0d2a1b;

        --color-success-50: var(--color-green-50);
        --color-success-100: var(--color-green-100);
        --color-success-200: var(--color-green-200);
        --color-success-300: var(--color-green-300);
        --color-success-400: var(--color-green-400);
        --color-success-500: var(--color-green-500);
        --color-success-600: var(--color-green-600);
        --color-success-700: var(--color-green-700);
        --color-success-800: var(--color-green-800);
        --color-success-900: var(--color-green-900);
        --color-success-950: var(--color-green-950);

        --color-red-50: #fef2f2;
        --color-red-100: #fee2e2;
        --color-red-200: #fecaca;
        --color-red-300: #fca5a5;
        --color-red-400: #f87171;
        --color-red-500: #ef4444;
        --color-red-600: #dc2626;
        --color-red-700: #b91c1c;
        --color-red-800: #991b1b;
        --color-red-900: #7f1d1d;
        --color-red-950: #450a0a;

        --color-danger-50: var(--color-red-50);
        --color-danger-100: var(--color-red-100);
        --color-danger-200: var(--color-red-200);
        --color-danger-300: var(--color-red-300);
        --color-danger-400: var(--color-red-400);
        --color-danger-500: var(--color-red-500);
        --color-danger-600: var(--color-red-600);
        --color-danger-700: var(--color-red-700);
        --color-danger-800: var(--color-red-800);
        --color-danger-900: var(--color-red-900);
        --color-danger-950: var(--color-red-950);

        --color-yellow-50: #fefce8;
        --color-yellow-100: #fef9c3;
        --color-yellow-200: #fef08a;
        --color-yellow-300: #fde047;
        --color-yellow-400: #facc15;
        --color-yellow-500: #eab308;
        --color-yellow-600: #ca8a04;
        --color-yellow-700: #a16207;
        --color-yellow-800: #854d09;
        --color-yellow-900: #713f12;
        --color-yellow-950: #422006;

        --color-warning-50: var(--color-yellow-50);
        --color-warning-100: var(--color-yellow-100);
        --color-warning-200: var(--color-yellow-200);
        --color-warning-300: var(--color-yellow-300);
        --color-warning-400: var(--color-yellow-400);
        --color-warning-500: var(--color-yellow-500);
        --color-warning-600: var(--color-yellow-600);
        --color-warning-700: var(--color-yellow-700);
        --color-warning-800: var(--color-yellow-800);
        --color-warning-900: var(--color-yellow-900);
        --color-warning-950: var(--color-yellow-950);

        --color-sky-50: #f0f9ff;
        --color-sky-100: #e0f2fe;
        --color-sky-200: #bae6fd;
        --color-sky-300: #7dd3fc;
        --color-sky-400: #38bdf8;
        --color-sky-500: #0ea5e9;
        --color-sky-600: #0284c7;
        --color-sky-700: #0369a1;
        --color-sky-800: #075985;
        --color-sky-900: #082f49;
        --color-sky-950: #082f49;

        --color-info-50: var(--color-sky-50);
        --color-info-100: var(--color-sky-100);
        --color-info-200: var(--color-sky-200);
        --color-info-300: var(--color-sky-300);
        --color-info-400: var(--color-sky-400);
        --color-info-500: var(--color-sky-500);
        --color-info-600: var(--color-sky-600);
        --color-info-700: var(--color-sky-700);
        --color-info-800: var(--color-sky-800);
        --color-info-900: var(--color-sky-900);
        --color-info-950: var(--color-sky-950);

        --color-slate-50: #f8fafc;
        --color-slate-100: #f1f5f9;
        --color-slate-200: #e2e8f0;
        --color-slate-300: #cbd5e1;
        --color-slate-400: #94a3b8;
        --color-slate-500: #64748b;
        --color-slate-600: #475569;
        --color-slate-700: #334155;
        --color-slate-800: #1e293b;
        --color-slate-900: #0f172a;
        --color-slate-950: #020617;

        --color-gray-50: var(--color-slate-50);
        --color-gray-100: var(--color-slate-100);
        --color-gray-200: var(--color-slate-200);
        --color-gray-300: var(--color-slate-300);
        --color-gray-400: var(--color-slate-400);
        --color-gray-500: var(--color-slate-500);
        --color-gray-600: var(--color-slate-600);
        --color-gray-700: var(--color-slate-700);
        --color-gray-800: var(--color-slate-800);
        --color-gray-900: var(--color-slate-900);
        --color-gray-950: var(--color-slate-950);
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Start of the React App component code from the Canvas
        function App() {
          const [objectives, setObjectives] = React.useState([]);
          const [automations, setAutomations] = React.useState([]);
          const [kpis, setKpis] = React.useState({
            ytd_revenue: { value: 0, source: '' },
            active_clients: { value: 0, source: '' },
            leads_this_month: { value: 0, source: '' },
            conversion_rate_month: { value: 0, source: '' },
          });
          const [coachMessages, setCoachMessages] = React.useState([]);
          const [upcomingTasks, setUpcomingTasks] = React.useState([]);
          const [reviews, setReviews] = React.useState([]);
          // New state for scores
          const [objectiveScore, setObjectiveScore] = React.useState(0);
          const [ndeverScore, setNdeverScore] = React.useState(0);
          const [todaysGrowthPoints, setTodaysGrowthPoints] = React.useState(0); // Points earned today for Ndever Score


          // --- Helper Functions for Elixir-like dynamic content ---
          const greeting_by_time = () => {
            const hour = new Date().getHours();
            if (hour < 12) return "Good morning";
            if (hour < 18) return "Good afternoon";
            return "Good evening";
          };

          // Removed old motivational messages as the new score cards handle this
          // const get_motivational_message = (stats, todays_tasks) => { ... };
          // const get_focus_message = (todays_tasks_count) => { ... };
          // const get_streak_display = (completed_today_count) => { ... };
          // const get_momentum_message = (completed_today_count) => { ... };

          // Consolidated objective completion to use its inherent progress for card display
          const calculate_objective_completion = (objective) => {
            return objective.progress;
          };

          // NEW: Calculate the overall Objective Score
          const calculateOverallObjectiveScore = (objs) => {
              if (!objs || objs.length === 0) return 0;
              let totalWeightedProgress = 0;
              let totalWeight = 0;
              objs.forEach(obj => {
                  totalWeightedProgress += (obj.progress * (obj.weight || 1)); // Default weight to 1 if not defined
                  totalWeight += (obj.weight || 1);
              });
              return totalWeight === 0 ? 0 : Math.round(totalWeightedProgress / totalWeight);
          };

          const formatCurrency = (value) => {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
          };

          const formatPercentage = (value) => {
            return new Intl.NumberFormat('en-US', { style: 'percent', minimumFractionDigits: 0, maximumFractionDigits: 2 }).format(value);
          };

          React.useEffect(() => {
            // Simulate fetching initial dashboard data
            const fetchDashboardData = () => {
              const mockObjectives = [
                {
                  id: 'obj1',
                  name: 'Annual GCI Target 2025',
                  status: 'on_track', // on_track, at_risk, behind, completed
                  progress: 65, // This is the value that will be used for display
                  weight: 5, // Added weight for Objective Score calculation
                  metrics_definition: {
                    gci_target: { type: 'currency', label: 'GCI Target' },
                    current_gci: { type: 'currency', label: 'Current GCI' },
                    leads_generated: { type: 'number', label: 'Leads Generated' },
                    conversion_rate: { type: 'percentage', label: 'Conversion Rate' },
                  },
                  current_values: {
                    gci_target: 250000,
                    current_gci: 162500,
                    leads_generated: 150,
                    conversion_rate: 0.08, // 8%
                  },
                  target_values: {
                    gci_target: 250000,
                    leads_generated: 200,
                    conversion_rate: 0.10, // 10%
                  },
                },
                {
                  id: 'obj2',
                  name: 'Increase Client Referrals',
                  status: 'at_risk',
                  progress: 40,
                  weight: 3, // Added weight for Objective Score calculation
                  metrics_definition: {
                    referrals_target: { type: 'number', label: 'Referrals Target' },
                    current_referrals: { type: 'number', label: 'Current Referrals' },
                    client_satisfaction_score: { type: 'scale', label: 'CSAT Score' },
                  },
                  current_values: {
                    referrals_target: 50,
                    current_referrals: 20,
                    client_satisfaction_score: 4.2,
                  },
                  target_values: {
                    referrals_target: 50,
                    client_satisfaction_score: 4.5,
                  },
                },
                {
                  id: 'obj3',
                  name: 'Improve Client Retention Rate',
                  status: 'behind',
                  progress: 20,
                  weight: 4, // Added weight
                  metrics_definition: {
                    retention_rate: { type: 'percentage', label: 'Retention Rate' },
                    churn_rate: { type: 'percentage', label: 'Churn Rate' },
                  },
                  current_values: {
                    retention_rate: 0.85,
                    churn_rate: 0.15,
                  },
                  target_values: {
                    retention_rate: 0.90,
                    churn_rate: 0.10,
                  },
                },
              ];
              setObjectives(mockObjectives);

              setKpis({
                ytd_revenue: { value: 175000, source: 'Quickbooks' },
                active_clients: { value: 120, source: 'CRM (e.g., Follow Up Boss)' },
                leads_this_month: { value: 25, source: 'CRM (e.g., Follow Up Boss)' },
                conversion_rate_month: { value: 0.07, source: 'Derived from CRM' },
              });

              setAutomations([
                {
                  id: 'auto1',
                  name: 'Past Client Nurturing Sequence',
                  status: 'Active',
                  executions_today: 15,
                  executions_this_week: 75,
                  type: 'email_sequence',
                  last_executed: '2025-06-09T14:30:00Z',
                  integration_source: 'Mailchimp & CRM'
                },
                {
                  id: 'auto2',
                  name: 'Birthday Flower Send',
                  status: 'Active',
                  executions_today: 2,
                  executions_this_week: 8,
                  type: 'gift_delivery',
                  last_executed: '2025-06-09T10:00:00Z',
                  integration_source: 'Flower Delivery Service & CRM'
                },
                {
                  id: 'auto3',
                  name: 'New Prospect Onboarding',
                  status: 'Active',
                  executions_today: 3,
                  executions_this_week: 12,
                  type: 'crm_update_sms',
                  last_executed: '2025-06-09T09:15:00Z',
                  integration_source: 'CRM & Twilio (SMS)'
                },
                 {
                  id: 'auto4',
                  name: 'Referral Follow-up Check-in',
                  status: 'Active',
                  executions_today: 5,
                  executions_this_week: 20,
                  type: 'email_notification',
                  last_executed: '2025-06-09T11:00:00Z',
                  integration_source: 'CRM & Internal Ndever'
                },
              ]);

              setCoachMessages([
                { sender: 'coach', text: "Good morning, Loren! Your 'Increase Client Referrals' objective is currently at 40%, and your 'Referral Partner Check-ins' automation ran 5 times today. Your 'Client Satisfaction Score' is excellent at 4.2. Shall we activate the advanced 'Past Client Nurturing' workflow to maximize repeat and referral business?" },
                { sender: 'user', text: "Morning! Yes, let's talk about client nurturing. I want to make sure I'm not dropping any referrals and staying top-of-mind without feeling overwhelmed." },
                { sender: 'coach', text: "Understood. The 'Past Client Nurturing' workflow will automate personalized emails and prompt you for birthday/anniversary touches. I've also highlighted tasks in your 'Client Retention Playbook' that focus on direct outreach to your key referral partners. How does that sound?" },
                { sender: 'user' , text: "Thanks. Can you also help me with level-up my prospecting?" },
                { sender: 'coach', text: "Absolutely. I've highlighted tasks in your \"Prospecting Playbook\" that directly impact lead volume. Also, consider activating the \"Automated Lead Nurturing\" workflow for recent website visitors." },
              ]);

              setUpcomingTasks([
                { id: 'task1', name: 'Review Ndever Coach QuickBooks analysis of Q2 budget (Playbook: Financial Health)', dueDate: 'Today' },
                { id: 'task2', name: 'Call client Barbara for referral (Playbook: Client Retention)', dueDate: 'Thu, Jun 12' },
                { id: 'task3', name: 'Send contract to new buyer via CRM template (Playbook: Deal Closure)', dueDate: 'Tomorrow' },
              ]);

              // Mock data for reviews
              setReviews([
                { id: 'google', name: 'Google Reviews', rating: 4.8, count: 185, link: 'https://google.com/your-business' },
                { id: 'zillow', name: 'Zillow Premier Agent', rating: 4.9, count: 92, link: 'https://zillow.com/your-profile' },
                { id: 'website', name: 'Website Reviews', rating: 4.7, count: 56, link: 'https://yourwebsite.com/reviews' },
              ]);

              // Calculate and set the new scores
              const calculatedObjectiveScore = calculateOverallObjectiveScore(mockObjectives);
              setObjectiveScore(calculatedObjectiveScore);
              setNdeverScore(750); // Mock Ndever Score
              setTodaysGrowthPoints(50); // Mock points earned today
            };

            fetchDashboardData();
          }, []); // Empty dependency array ensures this runs once on mount

          // --- React Components for Dashboard Elements ---

          const Icon = ({ name, className }) => {
            // Placeholder for Heroicons or other SVG icons
            const icons = {
              "hero-scale": ( // For Objective Score
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M10.125 12.75l-1.108 1.107A.75.75 0 018.842 14v-.825a2.25 2.25 0 00-2.25-2.25H4.125m11.25 0h-.825a2.25 2.25 0 00-2.25 2.25v.825c0 .211-.081.416-.226.561l-1.108 1.107c-.42.42-.647 1-.647 1.636v.433a2.25 2.25 0 002.25 2.25h.825m0-15l1.108-1.107A.75.75 0 0115.158 10V10.825a2.25 2.25 0 002.25 2.25h1.625M9.75 3.75v.825a2.25 2.25 0 002.25 2.25h.825m0-4.5L12 3.75l-1.108 1.107A.75.75 0 0010.842 5V5.825a2.25 2.25 0 00-2.25 2.25H4.125" />
                </svg>
              ),
              "hero-sparkles": ( // For Ndever Score / Gamification
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M12 3a.75.75 0 01.75.75v16.5a.75.75 0 01-1.5 0V3.75A.75.75 0 0112 3zm.75 14.25l4.303 2.656a.75.75 0 001.233-.696l-1.02-4.839 3.636-3.486a.75.75 0 00-.435-1.32l-4.82-.587-2.288-4.478a.75.75 0 00-1.353.001L8.71 8.874l-4.82.587a.75.75 0 00-.435 1.32l3.636 3.486-1.02 4.839a.75.75 0 001.233.696L12 17.25z" />
                </svg>
              ),
              "hero-check-circle": (
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              ),
              "hero-fire": ( // For Today's Growth Wins
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 22.5 12 13.5H3.75z" />
                </svg>
              ),
              "hero-check": (
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
              ),
              "hero-star": ( // New star icon for reviews
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className={className}>
                  <path fillRule="evenodd" d="M10.868 2.884c.321-.772 1.415-.772 1.736 0l1.82 4.394a1.625 1.625 0 011.213.882l4.394 1.82c.772.321.772 1.415 0 1.736l-4.394 1.82a1.625 1.625 0 01-1.213.882l-1.82 4.394c-.321.772-1.415.772-1.736 0l-1.82-4.394a1.625 1.625 0 01-1.213-.882l-4.394-1.82c-.772-.321-.772-1.415 0-1.736l4.394-1.82a1.625 1.625 0 011.213-.882l1.82-4.394z" clipRule="evenodd" />
                </svg>
              )
            };
            return icons[name] || null;
          };

          const MetricDisplay = ({ definition, value, target }) => {
            let displayValue = value;
            if (definition.type === 'currency') displayValue = formatCurrency(value);
            if (definition.type === 'percentage') displayValue = formatPercentage(value);

            let targetDisplay = target;
            if (target !== undefined) {
                if (definition.type === 'currency') targetDisplay = formatCurrency(target);
                if (definition.type === 'percentage') targetDisplay = formatPercentage(target);
            }

            return (
              <div className="flex justify-between text-sm text-gray-700">
                <span>{definition.label}: <span className="font-semibold">{displayValue}</span></span>
                {target !== undefined && <span className="text-gray-500">Target: {targetDisplay}</span>}
              </div>
            );
          };

          const ObjectiveCard = ({ objective }) => {
            const statusColor = {
              'on_track': 'bg-[var(--color-success-100)] text-[var(--color-success-800)]',
              'at_risk': 'bg-[var(--color-warning-100)] text-[var(--color-warning-800)]',
              'behind': 'bg-[var(--color-danger-100)] text-[var(--color-danger-800)]',
              'completed': 'bg-[var(--color-info-100)] text-[var(--color-info-800)]',
            };

            return (
              <div className="bg-white p-4 rounded-lg shadow-sm mb-4">
                <div className="flex justify-between items-center mb-2">
                  <h3 className="text-lg font-semibold text-gray-800">{objective.name}</h3>
                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColor[objective.status]}`}>
                    {objective.status.replace('_', ' ').charAt(0).toUpperCase() + objective.status.replace('_', ' ').slice(1)}
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                  <div className="bg-[var(--color-primary-500)] h-2.5 rounded-full" style={{ width: `${objective.progress}%` }}></div>
                </div>
                <p className="text-sm text-gray-600 mb-3">{objective.progress}% Progress</p>
                <div className="space-y-1">
                  {Object.keys(objective.metrics_definition).map((key) => (
                    <MetricDisplay
                      key={key}
                      definition={objective.metrics_definition[key]}
                      value={objective.current_values[key]}
                      target={objective.target_values[key]}
                    />
                  ))}
                </div>
              </div>
            );
          };

          const AutomationCard = ({ automation }) => {
            return (
              <div className="flex items-center justify-between bg-white p-3 rounded-lg shadow-sm text-gray-700 mb-2">
                <div>
                  <h4 className="font-medium text-gray-800">{automation.name}</h4>
                  <p className="text-xs text-gray-500">Last run: {new Date(automation.last_executed).toLocaleTimeString()}</p>
                  {automation.integration_source && (
                    <p className="text-xs text-gray-500 mt-1">
                      <span className="font-medium text-gray-600">Source:</span> {automation.integration_source}
                    </p>
                  )}
                </div>
                <div className="text-right">
                  <p className="text-sm font-semibold">{automation.executions_today} Today</p>
                  <p className="text-xs text-gray-600">{automation.executions_this_week} This Week</p>
                </div>
              </div>
            );
          };

          const KPICard = ({ title, value, source }) => {
            return (
              <div className="bg-white p-5 rounded-lg shadow-sm flex flex-col items-start">
                <span className="text-sm text-gray-500">{title}</span>
                <span className="text-2xl font-bold text-[var(--color-primary-700)]">{value}</span>
                {source && <span className="text-xs text-gray-500 mt-1">Source: {source}</span>}
              </div>
            );
          };

          const ReviewSourceCard = ({ review }) => {
            return (
              <a href={review.link} target="_blank" rel="noopener noreferrer" className="block bg-white p-4 rounded-lg shadow-sm flex items-center space-x-3 hover:shadow-md transition-shadow">
                <Icon name="hero-star" className="w-6 h-6 text-yellow-500 flex-shrink-0" />
                <div className="flex-1">
                  <p className="text-sm font-medium text-gray-800">{review.name}</p>
                  <div className="flex flex-col text-xs text-gray-600">
                    <span className="font-bold">{review.rating} Stars</span>
                    <span className="text-gray-500">({review.count} reviews)</span>
                  </div>
                </div>
              </a>
            );
          };

          // Re-purposing todaysAchievements for a general "growth wins" tracker
          const todaysGrowthWinsData = [
              { title: "Completed 'Set Up Referral Automation' Playbook Task", playbook: { title: "Client Nurturing Playbook" }, completed_at: new Date(Date.now() - 30 * 60 * 1000) },
              { title: "Sent 15 Automated Client Check-in Emails", playbook: { title: "Past Client Nurturing" }, completed_at: new Date(Date.now() - 2 * 60 * 60 * 1000) },
              { title: "Updated 5 Lead Records in CRM", playbook: { title: "Lead Management Playbook" }, completed_at: new Date(Date.now() - 5 * 60 * 60 * 1000) }
          ];


          return (
            <div className="min-h-screen bg-gray-50 font-sans text-gray-900">
              {/* Header */}
              <header className="bg-white shadow-sm p-4 flex justify-between items-center border-b border-gray-200">
                <div className="flex items-center">
                  {/* Ndever Logo Image */}
                  <img src="./Logo-Color@2x.png" alt="Ndever Logo" className="h-8 w-auto mr-4" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/120x32/white/ed8622/white?text=Ndever+Logo'; }} />
                  <h1 className="text-xl font-semibold text-gray-800">Agency Dashboard</h1>
                </div>
                <div className="flex items-center space-x-4">
                  <span className="text-gray-600">Hi, Loren!</span>
                  {/* User Avatar Placeholder */}
                  <div className="w-10 h-10 rounded-full bg-[var(--color-info-200)] flex items-center justify-center text-[var(--color-info-800)] font-bold">L</div>
                </div>
              </header>

              <main className="p-6 md:p-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Header Section */}
                <div className="lg:col-span-3 mb-8">
                  <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
                    {greeting_by_time()}, Loren!
                  </h1>
                  <p className="text-lg text-gray-600 dark:text-gray-400 mb-3">
                    Your Ndever growth journey in progress.
                  </p>
                </div>

                {/* Growth Overview Scores (Objective Score, Ndever Score, Today's Growth Wins) */}
                <div className="lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                  {/* Objective Score Card */}
                  <div className="bg-gradient-to-br from-[var(--color-info-50)] to-[var(--color-info-100)] shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6 relative overflow-hidden flex flex-col justify-between">
                    <div className="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-[var(--color-info-500)]/10 rounded-full blur-2xl"></div>
                    <div className="relative flex items-center justify-between mb-4">
                      <div className="w-10 h-10 bg-gradient-to-br from-[var(--color-info-500)] to-[var(--color-info-600)] rounded-lg flex items-center justify-center shadow-lg">
                        <Icon name="hero-scale" className="w-5 h-5 text-white" />
                      </div>
                      <span className="text-xs font-semibold text-[var(--color-info-700)] uppercase tracking-wide">
                        Objective Score
                      </span>
                    </div>
                    <div className="relative">
                      <p className="text-4xl font-bold text-[var(--color-info-900)] mb-2">
                        {objectiveScore} / 100
                      </p>
                      <p className="text-sm text-[var(--color-info-700)] font-medium">
                        Your real-time growth momentum across objectives.
                      </p>
                    </div>
                  </div>

                  {/* Ndever Score Card */}
                  <div className="bg-gradient-to-br from-[var(--color-primary-50)] to-[var(--color-primary-100)] shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6 relative overflow-hidden flex flex-col justify-between">
                    <div className="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-[var(--color-primary-500)]/10 rounded-full blur-2xl"></div>
                    <div className="relative flex items-center justify-between mb-4">
                      <div className="w-10 h-10 bg-gradient-to-br from-[var(--color-primary-500)] to-[var(--color-primary-600)] rounded-lg flex items-center justify-center shadow-lg">
                        <Icon name="hero-sparkles" className="w-5 h-5 text-white" />
                      </div>
                      <span className="text-xs font-semibold text-[var(--color-primary-700)] uppercase tracking-wide">
                        Ndever Score
                      </span>
                    </div>
                    <div className="relative">
                      <p className="text-4xl font-bold text-[var(--color-primary-900)] mb-2">
                        {ndeverScore}
                      </p>
                      <p className="text-sm text-[var(--color-primary-700)] font-medium">
                        Cumulative growth achievement. Next award at {ndeverScore + 250}!
                      </p>
                      <div className="w-full bg-[var(--color-primary-200)] rounded-full h-2 mt-2">
                        <div className="bg-[var(--color-primary-600)] h-2 rounded-full" style={{ width: `${(ndeverScore % 250) / 2.5}%` }}></div>
                      </div>
                    </div>
                  </div>

                  {/* Today's Growth Wins Card */}
                  <div className="bg-gradient-to-br from-[var(--color-success-50)] to-[var(--color-success-100)] shadow-sm ring-1 ring-gray-900/5 rounded-xl p-6 relative overflow-hidden flex flex-col justify-between">
                    <div className="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-[var(--color-success-500)]/10 rounded-full blur-2xl"></div>
                    <div className="relative flex items-center justify-between mb-4">
                      <div className="w-10 h-10 bg-gradient-to-br from-[var(--color-success-500)] to-[var(--color-success-600)] rounded-lg flex items-center justify-center shadow-lg">
                        <Icon name="hero-fire" className="w-5 h-5 text-white" />
                      </div>
                      <span className="text-xs font-semibold text-[var(--color-success-700)] uppercase tracking-wide">
                        Today's Growth Wins
                      </span>
                    </div>
                    <div className="relative">
                      <p className="text-4xl font-bold text-[var(--color-success-900)] mb-2">
                        +{todaysGrowthPoints}
                      </p>
                      <p className="text-sm text-[var(--color-success-700)] font-medium">
                        Points earned today. Keep up the momentum!
                      </p>
                    </div>
                  </div>
                </div>

                <div className="lg:col-span-2 space-y-6">
                  {/* Objectives Section */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Your Active Objectives</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {objectives.map(obj => (
                        <ObjectiveCard key={obj.id} objective={obj} />
                      ))}
                    </div>
                  </section>

                  {/* Upcoming Tasks */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Upcoming Tasks</h2>
                    <ul className="space-y-3">
                      {upcomingTasks.map(task => (
                        <li key={task.id} className="flex items-center bg-gray-50 p-3 rounded-lg shadow-sm">
                          <input type="checkbox" className="form-checkbox h-5 w-5 text-[var(--color-primary-600)] rounded mr-3" />
                          <div className="flex-1">
                            <p className="text-base font-medium text-gray-800">{task.name}</p>
                            <p className="text-sm text-gray-500">{task.dueDate}</p>
                          </div>
                        </li>
                      ))}
                    </ul>
                  </section>
                </div>

                {/* Right Column: Ndever Coach, Automation Summary, Client Feedback */}
                <div className="space-y-6">
                  {/* Ndever Coach Chat */}
                  <section className="bg-white p-6 rounded-lg shadow-md h-96 flex flex-col">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Ndever Coach</h2>
                    <div className="flex-1 overflow-y-auto border border-gray-200 p-3 rounded-lg bg-gray-50 mb-3 text-sm">
                      {coachMessages.map((msg, index) => (
                        <div key={index} className={`mb-2 ${msg.sender === 'user' ? 'text-right' : 'text-left'}`}>
                          <span className={`inline-block p-2 rounded-lg ${
                            msg.sender === 'user' ? 'bg-[var(--color-primary-500)] text-white' : 'bg-gray-200 text-gray-800'
                          }`}>
                            {msg.text}
                          </span>
                        </div>
                      ))}
                      <div className="text-gray-400 text-xs text-center mt-2">Ndever Coach is typing...</div>
                    </div>
                    <div className="flex">
                      <input
                        type="text"
                        placeholder="Message Ndever Coach..."
                        className="flex-1 border border-gray-300 p-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]"
                      />
                      <button className="bg-[var(--color-primary-600)] text-white p-2 rounded-r-lg hover:bg-[var(--color-primary-700)] transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                          <path strokeLinecap="round" strokeLinejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                      </button>
                    </div>
                  </section>

                  {/* Workflow Automation Summary */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                      Workflow Automations
                      <span className="ml-2 px-2 py-1 bg-[var(--color-primary-100)] text-[var(--color-primary-700)] text-sm font-medium rounded-full">Active: {automations.length}</span>
                    </h2>
                    <div className="space-y-3">
                      <div className="bg-gray-100 p-4 rounded-lg text-center text-gray-700 font-semibold text-lg">
                        <span className="text-3xl font-bold text-[var(--color-primary-700)] mr-2">
                            {automations.reduce((sum, auto) => sum + auto.executions_today, 0)}
                        </span>Automations Executed Today
                      </div>
                      {automations.map(auto => (
                        <AutomationCard key={auto.id} automation={auto} />
                      ))}
                    </div>
                  </section>

                  {/* Client Feedback & Reputation Section */}
                  <section className="bg-white p-6 rounded-lg shadow-md">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Client Feedback & Reputation</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {reviews.map(review => (
                        <ReviewSourceCard key={review.id} review={review} />
                      ))}
                    </div>
                  </section>
                </div>
              </main>
            </div>
          );
        }

        // Mount the React App to the DOM
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container); // Create a root
        root.render(<App />); // Render the App
    </script>
</body>
</html>
